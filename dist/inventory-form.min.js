const getInventory=()=>new Promise((a,b)=>{fetch(`${baseUrl}/api/trailer`,{credentials:"include"}).then(a=>a.json()).then(c=>{if(c.status){const b={sections:[],selected:0},{data:d}=c;let e=-1,f="";for(const a of d){const{category:c}=a;c!==f&&e++,b.sections[e]||(f=c,b.sections.push({category:c,items:[],selected:0}));const d=b.sections[e];d.items.push(Object.assign({qty:0},a))}a(b)}else b(new Error(c.msg))})}),populateModal=a=>{const b=document.querySelector("div.user-management-modal");if(b){const c=b.querySelector("form"),d=b.querySelector("div.inventory-parent");d.querySelectorAll("div.inventory-content-div").forEach(a=>a.remove());const{sections:e}=a;for(const a of e){const b=document.createElement("div");b.className="inventory-content-div";{const c=document.createElement("div");c.className="inventory-title-div";{const b=document.createElement("div");b.className="title-text",b.textContent=a.category;const d=document.createElement("div");d.className="title-text font-400",d.textContent=`Total: ${a.selected}`,c.appendChild(b),c.appendChild(d)}b.appendChild(c);const{items:d}=a;for(const a of d){const c=document.createElement("div");c.className="inventory-input-content";{const b=document.createElement("div");b.className="title-text font-400",b.textContent=a.name;const d=document.createElement("div");d.className="title-text font-400",d.textContent=`${a.qty}`,c.appendChild(b),c.appendChild(d)}b.appendChild(c)}}d.appendChild(b)}c.addEventListener("submit",a=>{a.preventDefault(),a.stopImmediatePropagation(),alert("submitted!")})}};window.addEventListener("load",async()=>{const a=document.querySelector("div.inventory-content form"),b=document.querySelector("div.user-management-modal form");if(a&&b){const c=a.querySelector("div.inventory-parent");try{a.querySelectorAll(".inventory-content-div").forEach(a=>a.remove());const d=await getInventory(),{sections:e}=d;for(const a of e){const b=document.createElement("div");b.className="inventory-content-div";{const c=document.createElement("div");c.className="inventory-title-div";{const b=document.createElement("div");b.className="title-text",b.textContent=a.category;const d=document.createElement("div");d.className="title-text font-400",d.textContent="Enter Quantity",c.appendChild(b),c.appendChild(d)}b.appendChild(c);const{items:d}=a;for(const c of d){const d=document.createElement("div");d.className="inventory-input-content";{const b=document.createElement("div");b.className="title-text font-400",b.textContent=c.name;const e=document.createElement("input");e.className="inventory-text-field w-input",e.type="text",e.placeholder="0",e.addEventListener("input",b=>{const d=b.data;let f=e.value;/^[0-9]+$/g.test(d)||(f=f.replace(d,"")),e.value=f;const g=+f;a.selected+=g-c.qty,c.qty=g}),d.appendChild(b),d.appendChild(e)}b.appendChild(d)}}c.appendChild(b)}a.addEventListener("submit",a=>{a.preventDefault(),a.stopImmediatePropagation(),populateModal(d)}),b.addEventListener("submit",async a=>{a.preventDefault(),a.stopImmediatePropagation();const b=[];for(const c of d.sections)for(const a of c.items){const{model_no:c,qty:d}=a;b.push({model_no:c,qty:d})}const c=await fetch(`${baseUrl}/api/inventory`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b),credentials:"include"}),e=await c.json();e.status?(alert(e.msg),window.location.pathname="/dashboard"):alert(e.msg)})}catch(a){console.error(a)}}else console.error(new Error("Inventory form element missing!"))});