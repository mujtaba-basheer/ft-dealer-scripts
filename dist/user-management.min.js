const deleteUser=async(a,b)=>{try{const c=await fetch(`${baseUrl}/api/user/${a}`,{method:"DELETE",credentials:"include"}),d=await c.json(),{status:e,msg:f}=d;if(!e)throw new Error(f);alert(f),b.remove()}catch(a){console.error(a),alert(a.message)}},editUser=async(a,b,c)=>{try{const d=await fetch(`${baseUrl}/api/user/${a}`,{method:"PUT",credentials:"include",body:JSON.stringify(b),headers:{"Content-Type":"application/json"}}),e=await d.json(),{status:f,msg:g}=e;if(!f)throw new Error(g);c(),alert(g)}catch(a){console.error(a),alert(a.message)}},renderUsers=a=>{try{const b=document.getElementById("user-parent");if(b){b.querySelectorAll("div.single-user").forEach(a=>a.style.display="none");for(const c of a){const{name:a,email:d,role:e,self:f}=c,g=document.createElement("div");g.className="single-user";{const b=document.createElement("div");b.id="default-state",b.className="default-user-state";{const c=document.createElement("div");c.className="user-personal-col name";{const b=document.createElement("div");b.id="name",b.className="user-nav-text",b.textContent=a+(f?" (you)":""),c.appendChild(b)}const i=document.createElement("div");i.className="user-personal-col email";{const a=document.createElement("div");a.id="email",a.className="user-nav-text normal-400",a.textContent=d,i.appendChild(a)}const j=document.createElement("div");j.className="user-personal-col role";{const a=document.createElement("div");a.className="role-div";{const c=document.createElement("div");c.id="role",c.className="user-nav-text normal-400",c.textContent=e;const f=document.createElement("div");f.className="edit-option-div";{const a=document.createElement("a");a.className="edit-user-div w-inline-block",a.href="#";{const b=document.createElement("img");b.className="edit-icon",b.src="https://assets.website-files.com/6436e391fe5f1a46d86470fe/64372284a2c5886a30eeeb6a_Vector.png",b.loading="lazy",b.alt="";const c=document.createElement("div");c.className="user-nav-text normal-400 grey",c.textContent="Edit User",a.appendChild(b),a.appendChild(c)}a.addEventListener("click",a=>{a.preventDefault(),b.style.display="none",h.style.display="block"});const c=document.createElement("a");c.className="remove-user-div w-inline-block",c.href="#";{const a=document.createElement("img");a.className="edit-icon",a.src="https://assets.website-files.com/6436e391fe5f1a46d86470fe/643722d6959011151e3f7a5f_Vector.png",a.loading="lazy",a.alt="";const b=document.createElement("div");b.className="user-nav-text normal-400 grey",b.textContent="Remove User",c.appendChild(a),c.appendChild(b)}c.addEventListener("click",a=>{a.preventDefault(),deleteUser(d,g)}),f.appendChild(a),f.appendChild(c)}a.appendChild(c),a.appendChild(f)}j.appendChild(a)}b.appendChild(c),b.appendChild(i),b.appendChild(j)}const h=document.createElement("div");h.className="edit-user-state",h.id="edit-state",h.style.display="none";{const f=document.createElement("div");f.className="form-block w-form";const g={Admin:1,Dealer:2,"Fontaine Sales Team":3,"Dealer Sales Team":4},i=["Admin","Dealer","Fontaine Sales Team","Dealer Sales Team"];{const j=document.createElement("form");j.className="form-2";{const f=document.createElement("div");f.className="user-personal-col name";{const b=document.createElement("input");b.className="w-input",b.id="name",b.required=!0,b.value=a,f.appendChild(b)}const k=document.createElement("div");k.className="user-personal-col email";{const a=document.createElement("div");a.className="user-nav-text normal-400",a.textContent=d,k.appendChild(a)}const l=document.createElement("div");l.className="user-personal-col role";{const a=document.createElement("div");a.className="role-div";{const b=document.createElement("select");b.id="role",b.innerHTML=`><option value="2">Dealer</option><option value="1">Admin</option><option value="3">Fontaine Sales Team</option><option value="4">Dealer Sales Team</option>`,b.value=g[e]+"",a.appendChild(b)}l.appendChild(a)}const m=document.createElement("a");m.className="button-2 w-button",m.href="#",m.textContent="Cancel",m.addEventListener("click",a=>{a.preventDefault(),h.style.display="none",b.style.display="flex",f.querySelector("input").value=c.name,l.querySelector("select").value=g[c.role]});const n=document.createElement("input");n.className="submit-button-2 w-button",n.type="submit",n.value="Save changes",n.setAttribute("data-wait","Please wait..."),n.addEventListener("click",a=>{a.preventDefault();const e={name:h.querySelector("#name").value,role:+h.querySelector("#role").value};editUser(d,e,()=>{c.name=e.name,c.role=i[e.role-1],console.log({name:c.name,role:c.role}),h.style.display="none",b.style.display="flex",b.querySelector("#name").textContent=c.name+(c.self?" (you)":""),b.querySelector("#role").textContent=c.role})}),j.appendChild(f),j.appendChild(k),j.appendChild(l),j.appendChild(m),j.appendChild(n)}f.appendChild(j)}h.appendChild(f)}g.appendChild(b),g.appendChild(h)}b.appendChild(g)}}else throw new Error("Users container element missing!")}catch(a){console.error(a)}};window.addEventListener("load",async()=>{try{const a=await fetch(`${baseUrl}/api/user`,{credentials:"include"}),b=await a.json();if(b.status){const{data:a}=b;renderUsers(a);const c=document.getElementById("email-form");if(c)c.addEventListener("submit",async a=>{a.preventDefault(),a.stopImmediatePropagation();try{const a={email:"",role:0},b=c.querySelector(`input[name="email"]`);b&&(a.email=b.value);const d=c.querySelector(`select[name="field"]`);d&&(a.role=+d.value);const e=await fetch(`${baseUrl}/api/user`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),credentials:"include"}),f=await e.json();if(!f.status)throw new Error(f.msg);alert("User added successfully!");const g=document.querySelector("div.user-management-modal .close-btn");g&&g.click()}catch(a){console.error(a),alert(a.message)}});else throw new Error("Add User form not found!")}else if(4===parseInt(a.status/100+""))window.location.pathname="/dashboard";else throw new Error(b.msg)}catch(a){console.error(a)}});