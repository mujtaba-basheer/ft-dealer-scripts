const deleteUser=async(a,b)=>{try{const c=await fetch(`${baseUrl}/api/user/${a}`,{method:"DELETE",credentials:"include"}),d=await c.json(),{status:e,msg:f}=d;if(!e)throw new Error(f);alert(f),b.remove()}catch(a){console.error(a),alert(a.message)}},renderUsers=a=>{try{const b=document.getElementById("user-parent");if(b)for(const c of a){const{name:a,email:d,role:e,self:f}=c,g=document.createElement("div");g.className="single-user";{const b=document.createElement("div");b.id="default-state",b.className="default-user-state";{const h=document.createElement("div");h.className="user-personal-col name";{const b=document.createElement("div");b.className="user-nav-text",b.textContent=a+(f?" (you)":""),h.appendChild(b)}const i=document.createElement("div");i.className="user-personal-col email";{const a=document.createElement("div");a.className="user-nav-text normal-400",a.textContent=d,i.appendChild(a)}const j=document.createElement("div");j.className="user-personal-col role";{const a=document.createElement("div");a.className="role-div";{const f=document.createElement("div");f.className="user-nav-text normal-400",f.textContent=e;const h=document.createElement("div");h.className="edit-option-div";{const a=document.createElement("a");a.className="edit-user-div w-inline-block",a.href="#";{const b=document.createElement("img");b.className="edit-icon",b.src="https://assets.website-files.com/6436e391fe5f1a46d86470fe/64372284a2c5886a30eeeb6a_Vector.png",b.loading="lazy",b.alt="";const c=document.createElement("div");c.className="user-nav-text normal-400 grey",c.textContent="Edit User",a.appendChild(b),a.appendChild(c)}a.addEventListener("click",a=>{a.preventDefault(),b.style.display="none",c.style.display="block"});const e=document.createElement("a");e.className="remove-user-div w-inline-block",e.href="#";{const a=document.createElement("img");a.className="edit-icon",a.src="https://assets.website-files.com/6436e391fe5f1a46d86470fe/643722d6959011151e3f7a5f_Vector.png",a.loading="lazy",a.alt="";const b=document.createElement("div");b.className="user-nav-text normal-400 grey",b.textContent="Remove User",e.appendChild(a),e.appendChild(b)}e.addEventListener("click",a=>{a.preventDefault(),deleteUser(d,g)}),h.appendChild(a),h.appendChild(e)}a.appendChild(f),a.appendChild(h)}j.appendChild(a)}b.appendChild(h),b.appendChild(i),b.appendChild(j)}const c=document.createElement("div");c.className="edit-user-state",c.id="edit-state";{const e=document.createElement("div");e.className="form-block w-form";{const f=document.createElement("form");f.className="form-2";{const e=document.createElement("div");e.className="user-personal-col name";{const b=document.createElement("input");b.className="w-input",b.id="name",b.required=!0,b.value=a,e.appendChild(b)}const g=document.createElement("div");g.className="user-personal-col email";{const a=document.createElement("div");a.className="user-nav-text normal-400",a.textContent=d,g.appendChild(a)}const h=document.createElement("div");h.className="user-personal-col role";{const a=document.createElement("select");a.id="role",a.className="select-field-2 w-select",a.innerHTML=`<option value="2">Dealer</option><option value="1">Admin</option><option value="3">Fontaine Sales Team</option><option value="4">Dealer Sales Team</option>`,h.appendChild(a)}const i=document.createElement("a");i.className="button-2 w-button",i.href="#",i.textContent="Cancel",i.addEventListener("click",d=>{d.preventDefault(),c.style.display="none",b.style.display="flex",e.querySelector("input").value=a});const j=document.createElement("input");j.className="submit-button-2 w-button",j.type="submit",j.value="Save changes",j.setAttribute("data-wait","Please wait..."),f.appendChild(e),f.appendChild(g),f.appendChild(h),f.appendChild(i),f.appendChild(j)}e.appendChild(f)}c.appendChild(e)}g.appendChild(b),g.appendChild(c)}b.appendChild(g)}else throw new Error("Users container element missing!")}catch(a){console.error(a)}};window.addEventListener("load",async()=>{try{const a=await fetch(`${baseUrl}/api/user`,{credentials:"include"}),b=await a.json();if(b.status){const{data:a}=b;renderUsers(a);const c=document.getElementById("email-form");if(c)c.addEventListener("submit",async a=>{a.preventDefault(),a.stopImmediatePropagation();try{const a={email:"",role:0},b=c.querySelector(`input[name="email"]`);b&&(a.email=b.value);const d=c.querySelector(`select[name="field"]`);d&&(a.role=+d.value);const e=await fetch(`${baseUrl}/api/user`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),credentials:"include"}),f=await e.json();if(!f.status)throw new Error(f.msg);alert("User added successfully!");const g=document.querySelector("div.user-management-modal .close-btn");g&&g.click()}catch(a){console.error(a),alert(a.message)}});else throw new Error("Add User form not found!")}else if(4===parseInt(a.status/100+""))window.location.pathname="/dashboard";else throw new Error(b.msg)}catch(a){console.error(a)}});